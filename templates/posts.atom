<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en-US">
  <title>Kyle Mahan{% if title %}: {{ title }}{% endif %}</title>
  <link href="http://kylewm.com" rel="alternate" title="Kyle Mahan" type="text/html"></link>
  <link href="{{ request.base_url }}" rel="self"></link>
  <link rel="hub" href="http://pubsubhubbub.appspot.com/"></link>
  <id>http://kylewm.com/all.atom</id>
  <author>
    <name>Kyle</name>
    <uri>http://kylewm.com</uri>
  </author>
  <updated>{{ posts | first | attr('pub_date') | strftime('%Y-%m-%dT%H:%M:%SZ') }}</updated>

  {% for post in posts %}

  <entry>
    <updated>{{ post.pub_date | strftime('%Y-%m-%dT%H:%M:%SZ') }}</updated>
    <published>{{ post.pub_date | strftime('%Y-%m-%dT%H:%M:%SZ') }}</published>
    <link href="{{ post.permalink }}" rel="alternate" type="text/html"/>
    <id>{{ post.permalink }}</id>
    <title type="xhtml">
      <div xmlns="http://www.w3.org/1999/xhtml">
	{% if post.share_contexts %}
	  {% for share in post.share_contexts %}
	    Shared {{share.permalink|prettify_url}}
	  {% endfor %}
        {% elif post.like_contexts %}
	  {% for like in post.like_contexts %}
	    Liked {{like.permalink|prettify_url}}
	  {% endfor %}
	{% else %}
  	  {{ (post.title or (post.html_content | html_to_plain)) | atom_sanitize }}
	{% endif %}
      </div>
    </title>
    <content type="xhtml" xml:base="http://kylewm.com/" xml:space="preserve">
      <div xmlns="http://www.w3.org/1999/xhtml">
	{% for reply in post.reply_contexts %}
	  <p>In reply to <a href="{{reply.permalink}}">{{reply.permalink|prettify_url}}</a></p>
	{% endfor %}
	{% for share in post.share_contexts %}
	  <p>Shared <a href="{{share.permalink}}">{{share.permalink|prettify_url}}</a></p>
	{% endfor %}
	{% for like in post.like_contexts %}
	  <p>Liked <a href="{{like.permalink}}">{{like.permalink|prettify_url}}</a></p>
	{% endfor %}

        {{ post.html_content | atom_sanitize }}
      </div>
    </content>
    <object-type xmlns="http://activitystrea.ms/spec/1.0/">http://activitystrea.ms/schema/1.0/{{ post.post_type }}</object-type>
  </entry>

{% endfor %}
</feed>
